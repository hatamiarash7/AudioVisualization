let startedAt,pausedAt,avg,ctx,actx,asource,gainNode,analyser,frequencyData,frequencyDataLength,timeData,media=["media/1.ogg"],fftSize=1024,background_gradient_color_1="#000011",background_gradient_color_2="#060D1F",background_gradient_color_3="#02243F",stars_color="#465677",stars_color_2="#B5BFD4",stars_color_special="#F451BA",TOTAL_STARS=1500,STARS_BREAK_POINT=140,stars=[],waveform_color="rgba(29, 36, 57, 0.05)",waveform_color_2="rgba(0,0,0,0)",waveform_line_color="rgba(157, 242, 157, 0.11)",waveform_line_color_2="rgba(157, 242, 157, 0.8)",waveform_tick=.05,TOTAL_POINTS=512,points=[],bubble_avg_color="rgba(29, 36, 57, 0.1)",bubble_avg_color_2="rgba(29, 36, 57, 0.05)",bubble_avg_line_color="rgba(77, 218, 248, 1)",bubble_avg_line_color_2="rgba(77, 218, 248, 1)",bubble_avg_tick=.001,TOTAL_AVG_POINTS=64,AVG_BREAK_POINT=100,avg_points=[],SHOW_STAR_FIELD=!0,SHOW_WAVEFORM=!0,SHOW_AVERAGE=!0,AudioContext=window.AudioContext||window.webkitAudioContext,floor=Math.floor,round=Math.round,random=Math.random,sin=Math.sin,cos=Math.cos,PI=Math.PI,PI_TWO=2*PI,PI_HALF=PI/180,w=0,h=0,cx=0,cy=0,playing=!1,rotation=0,msgElement=document.querySelector("#loading .msg");window.addEventListener("load",initialize,!1),window.addEventListener("resize",resizeHandler,!1);function initialize(){return AudioContext?void(ctx=document.createElement("canvas").getContext("2d"),actx=new AudioContext,document.body.appendChild(ctx.canvas),resizeHandler(),initializeAudio()):featureNotSupported()}function featureNotSupported(){return hideLoader(),document.getElementById("no-audio").style.display="block"}function hideLoader(){return document.getElementById("loading").className="hide"}function updateLoadingMessage(a){msgElement.textContent=a}function initializeAudio(){let a=new XMLHttpRequest;updateLoadingMessage("- Loading Audio Buffer -"),a.open("GET",media[0],!0),a.responseType="arraybuffer",a.onload=function(){updateLoadingMessage("- Decoding Audio File Data -"),analyser=actx.createAnalyser(),analyser.fftSize=fftSize,analyser.minDecibels=-100,analyser.maxDecibels=-30,analyser.smoothingTimeConstant=.8,actx.decodeAudioData(this.response,function(a){console.timeEnd("decoding audio data"),msgElement.textContent="- Ready -",audio_buffer=a,gainNode=actx.createGain(),gainNode.connect(analyser),analyser.connect(actx.destination),frequencyDataLength=analyser.frequencyBinCount,frequencyData=new Uint8Array(frequencyDataLength),timeData=new Uint8Array(frequencyDataLength),createStarField(),createPoints(),createAudioControls()},function(a){alert("Error decoding audio data"+a.err)})},a.send()}function createAudioControls(){let a=document.createElement("a");a.setAttribute("id","playcontrol"),a.textContent="pause",document.body.appendChild(a),a.addEventListener("click",function(a){a.preventDefault(),this.textContent=playing?"play":"pause",toggleAudio()}),playAudio(),hideLoader()}function toggleAudio(){playing?pauseAudio():playAudio()}function playAudio(){playing=!0,startedAt=pausedAt?Date.now()-pausedAt:Date.now(),asource=null,asource=actx.createBufferSource(),asource.buffer=audio_buffer,asource.loop=!0,asource.connect(gainNode),pausedAt?asource.start(0,pausedAt/1e3):asource.start(),animate()}function pauseAudio(){playing=!1,pausedAt=Date.now()-startedAt,asource.stop()}function getAvg(a){let b=0;return a.forEach(function(a){b+=a}),b/a.length}function clearCanvas(){let a=ctx.createLinearGradient(0,0,0,h);a.addColorStop(0,background_gradient_color_1),a.addColorStop(.96,background_gradient_color_2),a.addColorStop(1,background_gradient_color_3),ctx.beginPath(),ctx.globalCompositeOperation="source-over",ctx.fillStyle=a,ctx.fillRect(0,0,w,h),ctx.fill(),ctx.closePath(),a=null}function drawStarField(){let a,b,c,d;for(a=0,b=stars.length;a<b;a++){if(c=stars[a],d=avg>AVG_BREAK_POINT?avg/20:avg/50,c.x+=c.dx*d,c.y+=c.dy*d,c.z+=c.dz,c.dx+=c.ddx,c.dy+=c.ddy,c.radius=.2+.1*(c.max_depth-c.z),c.x<-cx||c.x>cx||c.y<-cy||c.y>cy){stars[a]=new Star;continue}ctx.beginPath(),ctx.globalCompositeOperation="lighter",ctx.fillStyle=c.color,ctx.arc(c.x+cx,c.y+cy,c.radius,PI_TWO,!1),ctx.fill(),ctx.closePath()}a=b=c=d=null}function drawAverageCircle(){let a,b,c,d,e,f;for(avg>AVG_BREAK_POINT?(rotation+=-bubble_avg_tick,d=avg+10*random(),ctx.strokeStyle=bubble_avg_line_color_2,ctx.fillStyle=bubble_avg_color_2):(rotation+=bubble_avg_tick,d=avg,ctx.strokeStyle=bubble_avg_line_color,ctx.fillStyle=bubble_avg_color),ctx.beginPath(),ctx.lineWidth=1,ctx.lineCap="round",ctx.save(),ctx.translate(cx,cy),ctx.rotate(rotation),ctx.translate(-cx,-cy),ctx.moveTo(avg_points[0].dx,avg_points[0].dy),(a=0,b=TOTAL_AVG_POINTS);a<b-1;a++)c=avg_points[a],c.dx=c.x+d*sin(PI_HALF*c.angle),c.dy=c.y+d*cos(PI_HALF*c.angle),e=(c.dx+avg_points[a+1].dx)/2,f=(c.dy+avg_points[a+1].dy)/2,ctx.quadraticCurveTo(c.dx,c.dy,e,f);c=avg_points[a],c.dx=c.x+d*sin(PI_HALF*c.angle),c.dy=c.y+d*cos(PI_HALF*c.angle),e=(c.dx+avg_points[0].dx)/2,f=(c.dy+avg_points[0].dy)/2,ctx.quadraticCurveTo(c.dx,c.dy,e,f),ctx.quadraticCurveTo(e,f,avg_points[0].dx,avg_points[0].dy),ctx.stroke(),ctx.fill(),ctx.restore(),ctx.closePath(),a=b=c=d=e=f=null}function drawWaveform(){let a,b,c,d,e,f;for(avg>AVG_BREAK_POINT?(rotation+=waveform_tick,ctx.strokeStyle=waveform_line_color_2,ctx.fillStyle=waveform_color_2):(rotation+=-waveform_tick,ctx.strokeStyle=waveform_line_color,ctx.fillStyle=waveform_color),ctx.beginPath(),ctx.lineWidth=1,ctx.lineCap="round",ctx.save(),ctx.translate(cx,cy),ctx.rotate(rotation),ctx.translate(-cx,-cy),ctx.moveTo(points[0].dx,points[0].dy),(a=0,b=TOTAL_POINTS);a<b-1;a++)c=points[a],d=timeData[a],c.dx=c.x+d*sin(PI_HALF*c.angle),c.dy=c.y+d*cos(PI_HALF*c.angle),e=(c.dx+points[a+1].dx)/2,f=(c.dy+points[a+1].dy)/2,ctx.quadraticCurveTo(c.dx,c.dy,e,f);d=timeData[a],c=points[a],c.dx=c.x+d*sin(PI_HALF*c.angle),c.dy=c.y+d*cos(PI_HALF*c.angle),e=(c.dx+points[0].dx)/2,f=(c.dy+points[0].dy)/2,ctx.quadraticCurveTo(c.dx,c.dy,e,f),ctx.quadraticCurveTo(e,f,points[0].dx,points[0].dy),ctx.stroke(),ctx.fill(),ctx.restore(),ctx.closePath(),a=b=c=d=e=f=null}function animate(){playing&&(window.requestAnimationFrame(animate),analyser.getByteFrequencyData(frequencyData),analyser.getByteTimeDomainData(timeData),avg=getAvg([].slice.call(frequencyData))*gainNode.gain.value,clearCanvas(),SHOW_STAR_FIELD&&drawStarField(),SHOW_AVERAGE&&drawAverageCircle(),SHOW_WAVEFORM&&drawWaveform())}function Star(){let a,b;this.x=Math.random()*w-cx,this.y=Math.random()*h-cy,this.z=this.max_depth=Math.max(w/h),this.radius=.2,a=0<this.x?1:-1,b=0<this.y?1:-1,Math.abs(this.x)>Math.abs(this.y)?(this.dx=1,this.dy=Math.abs(this.y/this.x)):(this.dx=Math.abs(this.x/this.y),this.dy=1),this.dx*=a,this.dy*=b,this.dz=-.1,this.ddx=.001*this.dx,this.ddy=.001*this.dy,this.color=this.y>cy/2?stars_color_2:110<avg?stars_color_2:avg>STARS_BREAK_POINT?stars_color_special:stars_color,a=b=null}function createStarField(){for(let a=-1;++a<TOTAL_STARS;)stars.push(new Star);i=null}function Point(a){this.index=a.index,this.angle=360*this.index/TOTAL_POINTS,this.updateDynamics=function(){this.radius=Math.abs(w,h)/10,this.x=cx+this.radius*sin(PI_HALF*this.angle),this.y=cy+this.radius*cos(PI_HALF*this.angle)},this.updateDynamics(),this.value=256*Math.random(),this.dx=this.x+this.value*sin(PI_HALF*this.angle),this.dy=this.y+this.value*cos(PI_HALF*this.angle)}function AvgPoint(a){this.index=a.index,this.angle=360*this.index/TOTAL_AVG_POINTS,this.updateDynamics=function(){this.radius=Math.abs(w,h)/10,this.x=cx+this.radius*sin(PI_HALF*this.angle),this.y=cy+this.radius*cos(PI_HALF*this.angle)},this.updateDynamics(),this.value=256*Math.random(),this.dx=this.x+this.value*sin(PI_HALF*this.angle),this.dy=this.y+this.value*cos(PI_HALF*this.angle)}function createPoints(){let a;for(a=-1;++a<TOTAL_POINTS;)points.push(new Point({index:a+1}));for(a=-1;++a<TOTAL_AVG_POINTS;)avg_points.push(new AvgPoint({index:a+1}));a=null}function resizeHandler(){w=window.innerWidth,h=window.innerHeight,cx=w/2,cy=h/2,ctx.canvas.width=w,ctx.canvas.height=h,points.forEach(function(a){a.updateDynamics()}),avg_points.forEach(function(a){a.updateDynamics()})}